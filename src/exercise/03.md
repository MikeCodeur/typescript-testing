# Setup and Teardown

### üí° Setup and Teardown

## üìù Tes notes

Detaille ce que tu as appris ici
`src/exercise/03.md`ou¬†sur¬†une¬†page¬†[Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous avons parfois besoin d‚Äôex√©cuter des op√©rations avant de lancer les tests.
Jest nous fournis des fonctions utiles :

```tsx
beforeEach(() => {
  initializeCityDatabase()
})

afterEach(() => {
  clearCityDatabase()
})
beforeAll(() => {
  return initializeCityDatabase()
})

afterAll(() => {
  return clearCityDatabase()
})
```

üìë Le liens [vers la doc](https://jestjs.io/docs/setup-teardown)

## Exercice

Dans cet exercice nous avons une classe qui repr√©sente une connexion √ß la base
de donn√©es. Il s‚Äôagit d‚Äôun singleton : `DataBaseConnexion.getInstance()`

Les m√©thodes utiles sont les suivantes:

- `clearDb : vide la bdd`
- `add` : ajoute un √©l√©ment √† notre bdd
- `addElements` : ajoute une liste d‚Äô√©l√©ments √† notre bdd
- `getSize` le nombre d‚Äô√©l√©ment en bdd

```tsx
//class
class DataBaseConnexion {
  private static instance: DataBaseConnexion
  private hostname: string
  private port: string
  private protocol: string
  private bdd: string[]
  private constructor() {
    this.hostname = process.env.bddhostname ?? 'localhost'
    this.port = process.env.bddport ?? '3301'
    this.protocol = process.env.bddprotocol ?? 'mysql'
    this.bdd = []
    console.log(
      `Connexion √† la BDD ${this.protocol} ${this.hostname} ${this.port}`,
    )
  }
  public static getInstance(): DataBaseConnexion {
    if (!DataBaseConnexion.instance) {
      DataBaseConnexion.instance = new DataBaseConnexion()
    }
    return DataBaseConnexion.instance
  }
  public disconnect() {
    console.log(
      `disconnect from ${this.protocol} ${this.hostname} ${this.port}`,
    )
  }
  public execute() {
    console.log(`execute on ${this.protocol} ${this.hostname} ${this.port}`)
  }
  public clearDb() {
    this.bdd = []
  }
  public add(el: string) {
    this.bdd.push(el)
  }
  public addElements(el: string[]) {
    this.bdd = this.bdd.concat(el)
  }
  public getSize() {
    return this.bdd.length
  }
}
```

Tu vas devoir r√©diger plusieurs tests, entre chaque test il faudrait vider la
`bdd`. Les test √† r√©diger :

Groupe `DataBaseConnexion:add`

- test d‚Äôajout d‚Äôun √©l√©ment : r√©sultat attendu size == 1
- test d‚Äôajout de 2 √©l√©ments : r√©sultat attendu size == 2
- test d‚Äôajout de 2 √©l√©ments puis `clearBb puis` ajout de 1 √©l√©ment : r√©sultat
  attendu size == 1

Groupe `DataBaseConnexion:addElements`

- test d‚Äôajout d‚Äôun array 2 √©l√©ments : r√©sultat attendu size == 2
- test d‚Äôajout d‚Äôun array 2 √©l√©ments 2 fois : r√©sultat attendu size == 4
- test d‚Äôajout d‚Äôun array 2 √©l√©ments puis un `add('')` : r√©sultat attendu size
  == 3

## üêú Feedback

Remplir le formulaire le
[formulaire de FeedBack.](https://go.mikecodeur.com/cours-react-avis?entry.1912869708=TypeScript%20PRO&entry.1430994900=7.Les%20Tests&entry.533578441=03%20Setup%20teardown)
